<?xml version="1.0" encoding="utf-8"?>
<package name="modelCovidseir" displayName="Add-On to the Epidemic Package for the covidSEIR model" isAddOn="True" extendsPackage="epi" version="1.0.0">
	<transformers>
		<transformer
			name="Download"
			isPrimary="True"
			displayName="Download Case Reporting Data"
			programName="Rscript"
			programArguments="getDelayData.R"
			extendsTransformer="epi_Primary"
			runContext="LocalOnly"
			isRunnable="True">
			<datafeeds>
				<datafeed name="ReportingDelays" displayName="Case Reporting Delays" dataScope="Scenario">
          <datasheets>
            <datasheet name="ReportingDelays" displayName="Case Reporting Delays" isSingleRow="True">
              <columns>
                <column name="InputDatasheetID" dataType="Integer" isPrimary="True"/>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="delayURL" dataType="String" displayName="Delay Data URL"/>
              </columns>
							<defaultRecords>
								<record columns="delayURL" values="https://github.com/andrew-edwards/rightTruncation/raw/master/data/delay_data_2021_01_05.rda"/>
							</defaultRecords>
            </datasheet>
          </datasheets>
        </datafeed>
				<datafeed name="DelayData" displayName="Case Reporting Delay Data" dataScope="Scenario" isOutput="True">
          <datasheets>
            <datasheet name="DelayData" displayName="Case Reporting Delay Data">
              <columns>
                <column name="ScenarioID" dataType="Integer"/>
                <column name="dateReported" dataType="String" displayName="Day on which each case was reported"/>
                <column name="dateSymptom" dataType="String" displayName="Day on which symptoms appeared"/>
                <column name="reportingGap" dataType="Integer" displayName="Delay between symptoms and case report (days)"/>
              </columns>
            </datasheet>
          </datasheets>
        </datafeed>
				<datafeed name="DelayOutput" displayName="Delay Data Raw Output" dataScope="Scenario" isOutput="True">
					<datasheets>
						<datasheet name="DelayOutput" displayName="Delay Data Raw Output" isSingleRow="True">
							<columns>
								<column name="ScenarioID" displayName="Scenario" dataType="Integer"/>
								<column name="DelayDataFile" displayName="Reporting Delay Data File" dataType="String" isExternalFile="True"/>
								<column name="DownloadDateTime" displayName="Download Date/Time" dataType="Date"/>
							</columns>
						</datasheet>
					</datasheets>
				</datafeed>
				<datafeed name="WeibullParameters" displayName="Weibull Shape and Scale Parameters" dataScope="Scenario" isOutput="True">
					<datasheets>
						<datasheet name="WeibullParameters" displayName="Weibull Shape and Scale Parameters" isSingleRow="True">
							<columns>
								<column name="ScenarioID" dataType="Integer"/>
								<column name="mleShape" dataType="Double" displayName="Shape Parameter"/>
								<column name="mleScale" dataType="Double" displayName="Scale Parameter"/>
							</columns>
						</datasheet>
					</datasheets>
				</datafeed>
				<datafeed name="DelayDist" displayName="Reporting Delay Distribution Parameters" dataScope="Scenario" isOutput="True">
					<datasheets>
						<datasheet name="DelayDist" displayName="Reporting Delay Distribution Parameters">
							<columns>
								<column name="ScenarioID" dataType="Integer"/>
								<column name="x" dataType="Double" displayName="x"/>
								<column name="y" dataType="Double" displayName="y"/>
							</columns>
						</datasheet>
					</datasheets>
				</datafeed>
			</datafeeds>
			<include>
				<transformer name="Fit"/>
				<transformer name="Project"/>
			</include>
		</transformer>
		<transformer
			name="Fit"
			displayName="Fitting Case Data"
			programName="Rscript"
			programArguments="fit.R"
			extendsTransformer="epi_Primary"
			isRunnable ="True">
			<datafeeds>
				<datafeed name="ContactRateFractions" displayName="Social distancing break points" dataScope="Scenario">
					<datasheets>
						<datasheet name="ContactRateFractions" displayname="Social distancing break points">
							<columns>
								<column name="InputDatasheetID" dataType="Integer" isPrimary="True" isInput="True"/>
								<column name="ScenarioID" dataType="Integer"/>
								<!-- <column name="BreakDay" dataType="Date" displayName="Breakpoint Day"/> -->
								<!-- this doesn't ned to be in order -->
								<column name="BreakDay" dataType="Integer" displayName="Breakpoint Day"/>
								<column name="PriorMean" dataType="Double" displayName="Prior Mean"/>
								<column name="PriorSD" dataType="Double" displayName="Prior SD"/>
							</columns>
							<defaultRecords>
								<record columns="BreakDay|PriorMean|PriorSD" values="0|0.4|0.2"/>
								<record columns="BreakDay|PriorMean|PriorSD" values="322|0.7|0.2"/>
								<record columns="BreakDay|PriorMean|PriorSD" values="247|0.95|0.2"/>
								<record columns="BreakDay|PriorMean|PriorSD" values="292|0.45|0.2"/>
							</defaultRecords>
						</datasheet>
					</datasheets>
				</datafeed>
				<datafeed name="SamplingFractions" displayName="Sampling Fractions" dataScope="Scenario">
					<datasheets>
						<datasheet name="SamplingFractions" displayName="Sampling Fractions">
							<columns>
								<column name="InputDatasheetID" dataType="Integer" isPrimary="True" isInput="True"/>
								<column name="ScenarioID" dataType="Integer"/>
								<!-- <column name="Date" dataType="Date" displayName="Date"/> -->
								<!-- this doesn't need to be in order -->
								<column name="Day" dataType="Integer" displayName="Day"/>
								<column name="Proportion" dataType="Double" displayName="Sampling Fraction"/>
							</columns>
							<defaultRecords>
								<record columns="Day|Proportion" values="0|0.2"/>
								<record columns="Day|Proportion" values="24|0.305"/>
								<record columns="Day|Proportion" values="26|0.67"/>
								<record columns="Day|Proportion" values="87|0.745"/>
								<record columns="Day|Proportion" values="130|0.814"/>
								<record columns="Day|Proportion" values="152|0.628"/>
								<record columns="Day|Proportion" values="158|0.775"/>
								<record columns="Day|Proportion" values="181|0.822"/>
								<record columns="Day|Proportion" values="208|0.134"/>
								<record columns="Day|Proportion" values="201|0.992"/>
							</defaultRecords>
						</datasheet>
					</datasheets>
				</datafeed>
				<datafeed name="General" displayName="Fitting and Projection Functions Parameters" dataScope="Scenario">
					<datasheets>
						<datasheet name="General" displayName="Fitting and Projection Functions Parameters" isSingleRow="True">
							<columns>
								<column name="ScenarioID" dataType="Integer" isPrimary="True" isInput="True"/>
								<column name="NPop" dataType="Integer" displayName="Population Size"/>
								<column name="I0PriorMean" dataType="Double" displayName="Initial Infected - prior mean"/>
								<column name="I0PriorSD" dataType="Double" displayName="Initial Infected - prior SD"/>
								<column name="R0PriorMean" dataType="Double" displayName="R0 - prior mean"/>
								<column name="R0PriorSD" dataType="Double" displayName="R0 - prior SD"/>
								<column name="EPriorMean" dataType="Double" displayName="Social distancing fraction - prior mean"/>
								<column name="EPriorSD" dataType="Double" displayName="Social distancing fraction - prior SD"/>
								<column name="StartDeclinePriorMean" dataType="Double" displayName="Start decline day - prior mean"/>
								<column name="StartDeclinePriorSD" dataType="Double" displayName="Start decline day - prior SD"/>
								<column name="EndDeclinePriorMean" dataType="Double" displayName="End decline day - prior mean"/>
								<column name="EndDeclinePriorSD" dataType="Double" displayName="End decline day - prior SD"/>
								<column name="FitType" dataType="Integer" displayName="Fit type" validationType="List" formula1="1:NUTS | 2:VB | 3:optimising"/>
								<column name="YAML" dataType="String" displayName="Y Advanced settings YAML filename" isExternalFile="True"/>
								<column name="RDS" dataType="String" displayName="Fit Result RDS Filename"/>
							</columns>
							<defaultRecords>
								<record columns="NPop|I0PriorMean|I0PriorSD|R0PriorMean|R0PriorSD|EPriorMean|EPriorSD|StartDeclinePriorMean|StartDeclinePriorSD|EndDeclinePriorMean|EndDeclinePriorSD|FitType|RDS" values="5071000|8|1|2.6|0.2|0.8|0.05|15|0.05|22|0.05|3|modelCovidseir_fit"/>
							</defaultRecords>
						</datasheet>
					</datasheets>
				</datafeed>
			</datafeeds>
		</transformer>
		<transformer
			name="Project"
			displayName="Covidseir Model - Project"
			programName="Rscript"
			programArguments="project.R"
			extendsTransformer="epi_Primary"
			isRunnable ="True">
			<datafeeds>
				<datafeed name="ProjParams" displayName="Fitting Function Parameters" dataScope="Scenario" isInput="True">
					<datasheets>
						<datasheet name="ProjParams" displayName="Fitting Function Parameters" isSingleRow="True">
							<columns>
								<column name="ScenarioID" dataType="Integer" isPrimary="True" isInput="True"/>
								<column name="DaysProject" dataType="Integer" displayName="Days to Project"/>
								<column name="MinIteration" dataType="Integer" displayName="Minimum Iteration"/>
								<column name="MaxIteration" dataType="Integer" diaplayName="Maximum Iteration"/>
								<column name="StartChange" dataType="Integer" displayName="Day of social distancing change"/>
								<!-- this number must be one of the columns of the segment table -->
								<column name="Resampling" dataType="Integer" displayName="Number of Samples"/>
								<column name="FSegment" dataType="Integer" displayName="Social distancing segment"/>
								<column name="Parallel" dataType="Integer" displayName="Parallel processing" validationType="List" formula1="1:Yes|0:No"/>
							</columns>
							<defaultRecords>
								<record columns="DaysProject|MinIteration|MaxIteration|StartChange|Resampling|FSegment|Parallel" values="45|1|50|5|30|1|1"/>
							</defaultRecords>
						</datasheet>
					</datasheets>
				</datafeed>
				<datafeed name="TidyProj" displayName="Fit to Case Data" dataScope="Scenario" isOutput="True">
					<datasheets>
						<datasheet name="TidyProj" displayName="Fit to Case Data">
							<columns>
								<column name="ScenarioID" dataType="Integer"/>
								<column name="Date" dataType="Date" displayName="Date"/>
								<column name="Day" dataType="Integer" displayName="Days elapsed"/>
								<column name="YRepMean" dataType="Double" displayName=""/>
								<column name="YRep05" dataType="Double" displayName=""/>
								<column name="YRep25" dataType="Double" displayName=""/>
								<column name="YRep50" dataType="Double" displayName=""/>
								<column name="YRep75" dataType="Double" displayName=""/>
								<column name="YRep95" dataType="Double" displayName=""/>
								<column name="MuMean" dataType="Double" displayName=""/>
								<column name="Mu05" dataType="Double" displayName=""/>
								<column name="Mu25" dataType="Double" displayName=""/>
								<column name="Mu50" dataType="Double" displayName=""/>
								<column name="Mu75" dataType="Double" displayName=""/>
								<column name="Mu95" dataType="Double" displayName=""/>
							</columns>
						</datasheet>
					</datasheets>
				</datafeed>
			</datafeeds>
		</transformer>
	</transformers>
	<layouts>
		<layout name="coreforms_ScenarioDatafeeds">
			<item name="ReportingDelays" appendTo="epi_Inputs"/>
			<item name="ContactRateFractions" appendTo="epi_Inputs"/>
			<item name="SamplingFractions" appendTo="epi_Inputs"/>
			<item name="General" appendTo="epi_Inputs"/>
			<item name="ProjParams" appendTo="epi_Inputs"/>
			<group name="Datafeeds" displayName="Delay Distribution" appendTo="epi_Outputs">
				<item name="DelayOutput"/>
				<item name="DelayData"/>
				<item name="WeibullParameters"/>
				<item name="DelayDist"/>
			</group>
			<item name="TidyProj" appendTo="epi_Outputs"/>
		</layout>
	</layouts>
</package>
